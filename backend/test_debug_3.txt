============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\jhapg\OneDrive\Desktop\ClassGrid\backend
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.10.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 17 items

tests\core\test_db.py .                                                  [  5%]
tests\routers\test_admin_users.py ....                                   [ 29%]
tests\routers\test_admin_users_mock.py ....                              [ 52%]
tests\routers\test_auth.py F                                             [ 58%]
tests\routers\test_users.py ....                                         [ 82%]
tests\routers\test_users_mock.py ..                                      [ 94%]
tests\test_sample.py .                                                   [100%]

================================== FAILURES ===================================
_________________________________ test_login __________________________________

    @pytest.mark.asyncio
    async def test_login():
        # init_db is handled by autouse fixture
    
        # Create a user manually
        user_id = "testlogin_user"
        password = "password123"
        hashed = get_password_hash(password)
    
>       existing_user = await User.find_one(User.user_id == user_id)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\routers\test_auth.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\beanie\odm\queries\find.py:1030: in __await__
    document = yield from self._find_one().__await__()  # type: ignore
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\beanie\odm\queries\find.py:997: in _find_one
    return await self.document_model.get_pymongo_collection().find_one(
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\motor\metaprogramming.py:75: in method
    return framework.run_on_executor(
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\motor\frameworks\asyncio\__init__.py:85: in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py:888: in run_in_executor
    self._check_closed()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <ProactorEventLoop running=False closed=True debug=False>

    def _check_closed(self):
        if self._closed:
>           raise RuntimeError('Event loop is closed')
E           RuntimeError: Event loop is closed

..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py:556: RuntimeError
=========================== short test summary info ===========================
FAILED tests/routers/test_auth.py::test_login - RuntimeError: Event loop is c...
======================== 1 failed, 16 passed in 39.43s ========================
